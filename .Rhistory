# Upload libraries
library(httr)
library(jsonlite)
library(xml2)
library(dplyr)
# Create API elements -----------------------------------------------------
url <- "https://app.ticketmaster.com/discovery/v2/events"
apikey <- "apikey=NqcnLGc44dacGS0uZClA8U3L5Gj3OnEs"
SheffieldCityCentre <- "&latlong=53.3812013,-1.4723287"
radius <- "&radius=10&unit=km"
source <- "&source=ticketmaster"
dates <- "&startDateTime=2019-03-29T10:59:00Z&endDateTime=2019-12-31T11:00:00Z"
page1 <- "&page=1"
page2 <- "&page=2"
page <- "&page="
events1 <- GET("https://app.ticketmaster.com/discovery/v2/events?apikey=NqcnLGc44dacGS0uZClA8U3L5Gj3OnEs&latlong=53.3812013,-1.4723287&radius=10&unit=km&source=ticketmaster&startDateTime=2019-03-29T10:59:00Z&endDateTime=2019-12-31T11:00:00Z&page=1") %>%
content()
View(events1)
View(events1)
events1[[1]]
first <- events1[[1]]
View(first)
first <- events1[[1]][[1]]
View(first)
View(first)
View(first)
first <- events1[[1]][[1]]
first
View(first)
first <- unlist(events1[[1]])
first
first <- events1[[1]]
View(first)
first <- events1[[1]]$events
View(first)
first <- events1[[1]]
paste0(url, apikey, SheffieldCityCentre, radius, source, dates)
totalPages <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates)) %>%
content()
GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates))
totalPages <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates)) %>%
content()
View(totalPages)
totalPages <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates, "&page=0")) %>%
content()
GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates))
events2 <- GET("https://app.ticketmaster.com/discovery/v2/events?apikey=NqcnLGc44dacGS0uZClA8U3L5Gj3OnEs&latlong=53.3812013,-1.4723287&radius=10&unit=km&source=ticketmaster&startDateTime=2019-03-29T10:59:00Z&endDateTime=2019-12-31T11:00:00Z&page=2") %>%
content()
url <- "https://app.ticketmaster.com/discovery/v2/events"
apikey <- "?apikey=NqcnLGc44dacGS0uZClA8U3L5Gj3OnEs"
SheffieldCityCentre <- "&latlong=53.3812013,-1.4723287"
radius <- "&radius=10&unit=km"
source <- "&source=ticketmaster"
dates <- "&startDateTime=2019-03-29T10:59:00Z&endDateTime=2019-12-31T11:00:00Z"
page <- "&page="
totalPages <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates)) %>%
content()
View(totalPages)
View(totalPages)
totalPages$page$totalPages
apicontent <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates)) %>%
content()
totalPages <- apicontent$page$totalPages
loop_pages <- function(i) {
events_on_page <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates, page, i))
list_events <- events_on_page[[1]]
all_events <- list.append(list_events)
}
list_all_events <- lapply(totalPages, loop_pages(totalPages))
install.packages("rlist")
library(rlist)
list_all_events <- lapply(totalPages, loop_pages(totalPages))
list_all_events <- lapply(1:totalPages, loop_pages)
View(list_all_events)
list_all_events[[1]]
list_all_events[[1]]
list_all_events[[2]]
list_all_events <- unlist(lapply(1:totalPages, loop_pages))
list_all_events
loop_pages <- function(i) {
events_on_page <- paste0(url, apikey, SheffieldCityCentre, radius, source, dates, page, i)
#list_events <- events_on_page[[1]]
all_events <- list.append(list_events)
}
all_pages <- unlist(lapply(1:totalPages, loop_pages))
loop_pages <- function(i) {
events_on_page <- paste0(url, apikey, SheffieldCityCentre, radius, source, dates, page, i)
#list_events <- events_on_page[[1]]
all_events <- list.append(events_on_page)
}
all_pages <- unlist(lapply(1:totalPages, loop_pages))
all_pages
loop_pages <- function(i) {
events_on_page <- paste0(url, apikey, SheffieldCityCentre, radius, source, dates, page, i)
list.append(events_on_page)
}
all_urls <- unlist(lapply(1:totalPages, loop_pages))
loop_pagesold
all_urls
all_urls[[1]]
all_urls <- unlist(lapply(0:totalPages, loop_pages))
lapply(all_urls, GET)
hm <- lapply(all_urls, GET %>% content())
get_json <- lapply(all_urls, GET)
View(get_json)
get_data <- content(get_json)
View(events1)
events1[[1]]
loop_pages <- function(i) {
events_on_page <- GET(paste0(url, apikey, SheffieldCityCentre, radius, source, dates, page, i)) %>% content()
list_events <- events_on_page[[1]]
all_events <- list.append(list_events)
}
all_events <- lapply(0:totalPages, loop_pages)
View(all_events)
all_events <- lapply(1:totalPages, loop_pages)
all_events[[1]]$events[[1]]$name
all_events[[1]]$events[[1]]$dates$start$localDate
all_events[[1]]$events[[1]]$classifications[[1]]$genre$name
length(all_events[[1]]$events)
length(all_events)
all_events[[i]]$events[[i]]$classifications[[1]]$genre$name
length(all_events[[1]]$events[[1]]$priceRanges)
all_events[[1]]$events[[1]]$priceRanges[[1]]$type
all_events[[1]]$events[[1]]$`_embedded`$venues[[1]]$parkingDetail
all_events[[1]]$events[[1]]$`_embedded`$venues[[1]]$address$line1
all_events[[1]]$events[[1]]$`_embedded`$venues[[1]]$postalCode
all_events[[1]]$events[[1]]$`_embedded`$venues[[1]]$address$line1
elements <- c(event_name, event_date, event_type,
price_min, price_max, venue_name,
venue_postalcode, venue_latitude,
venue_longitude, parking_info)
event_name <- all_events[[i]]$events[[j]]$name
event_date <- all_events[[i]]$events[[j]]$dates$start$localDate
event_type <- all_events[[i]]$events[[j]]$classifications[[1]]$genre$name
price_min <- all_events[[i]]$events[[j]]$priceRanges[[1]]$min
price_max <- all_events[[i]]$events[[j]]$priceRanges[[1]]$max
venue_name <- all_events[[i]]$events[[j]]$`_embedded`$venues[[1]]$name
venue_postalcode <- all_events[[i]]$events[[j]]$`_embedded`$venues[[1]]$postalCode
venue_longitude <- all_events[[i]]$events[[j]]$`_embedded`$venues[[1]]$location$longitude
venue_latitude <- all_events[[i]]$events[[j]]$`_embedded`$venues[[1]]$location$latitude
parking_info <- all_events[[i]]$events[[j]]$`_embedded`$venues[[1]]$parkingDetail
event_name <- all_events[[i]]$events[[j]]$name
collect_events <- function(i) {
event_name <- ifelse(is.null(all_events[[i]]$events[[1]]$name), NA, all_events[[i]]$events[[1]]$name)
event_date <- ifelse(is.null(all_events[[i]]$events[[1]]$dates$start$localDate), NA, all_events[[i]]$events[[1]]$dates$start$localDate)
event_time <- ifelse(is.null(all_events[[i]]$events[[1]]$dates$start$localTime), NA, all_events[[i]]$events[[1]]$dates$start$localTime)
event_type <- ifelse(is.null(all_events[[i]]$events[[1]]$classifications[[1]]$genre$name), NA, all_events[[i]]$events[[1]]$classifications[[1]]$genre$name)
price_min <- ifelse(is.null(all_events[[i]]$events[[1]]$priceRanges[[1]]$max), NA, all_events[[i]]$events[[1]]$priceRanges[[1]]$max)
price_max <- ifelse(is.null(all_events[[i]]$events[[1]]$priceRanges[[1]]$min), NA, all_events[[i]]$events[[1]]$priceRanges[[1]]$min)
venue_name <- ifelse(is.null(events$`_embedded`$events[[i]]$`_embedded`$venues[[1]]$name), NA, events$`_embedded`$events[[i]]$`_embedded`$venues[[1]]$name)
venue_postalcode <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$postalCode), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$postalCode)
longitude <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$longitude), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$longitude)
latitude <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$latitude), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$latitude)
parking <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$parkingDetail), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$parkingDetail)
data.frame("Event Name" = event_name,
"Event Date" = event_date,
"Event Time" = event_time,
"Event Type" = event_type,
"Standard Price Min" = price_min,
"Standard Price Max" = price_max,
"Venue Name" = venue_name,
"Venue Postcode" = venue_postalcode,
"Venue Latitude" = latitude,
"Venue Longitude" = longitude,
"Venue Parking" = parking)
}
events_data <- lapply(1:length(all_events), collect_events) %>%
bind_rows()
all_events[[1]]$events[[1]]$name
collect_events <- function(i) {
event_name <- ifelse(is.null(all_events[[i]]$events[[1]]$name), NA, all_events[[i]]$events[[1]]$name)
event_date <- ifelse(is.null(all_events[[i]]$events[[1]]$dates$start$localDate), NA, all_events[[i]]$events[[1]]$dates$start$localDate)
event_time <- ifelse(is.null(all_events[[i]]$events[[1]]$dates$start$localTime), NA, all_events[[i]]$events[[1]]$dates$start$localTime)
event_type <- ifelse(is.null(all_events[[i]]$events[[1]]$classifications[[1]]$genre$name), NA, all_events[[i]]$events[[1]]$classifications[[1]]$genre$name)
price_min <- ifelse(is.null(all_events[[i]]$events[[1]]$priceRanges[[1]]$max), NA, all_events[[i]]$events[[1]]$priceRanges[[1]]$max)
price_max <- ifelse(is.null(all_events[[i]]$events[[1]]$priceRanges[[1]]$min), NA, all_events[[i]]$events[[1]]$priceRanges[[1]]$min)
venue_name <- ifelse(is.null(all_events[[i]]$events[[1]]$name), NA, all_events[[i]]$events[[1]]$name)
venue_postalcode <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$postalCode), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$postalCode)
longitude <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$longitude), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$longitude)
latitude <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$latitude), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$location$latitude)
parking <- ifelse(is.null(all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$parkingDetail), NA, all_events[[i]]$events[[1]]$`_embedded`$venues[[1]]$parkingDetail)
data.frame("Event Name" = event_name,
"Event Date" = event_date,
"Event Time" = event_time,
"Event Type" = event_type,
"Standard Price Min" = price_min,
"Standard Price Max" = price_max,
"Venue Name" = venue_name,
"Venue Postcode" = venue_postalcode,
"Venue Latitude" = latitude,
"Venue Longitude" = longitude,
"Venue Parking" = parking)
}
events_data <- lapply(1:length(all_events), collect_events) %>%
bind_rows()
View(events_data)
View(all_events)
