?writeRDS
?saveRDS
data_frame_via_lapply <- function(data, udf) {
results <- lapply(data, udf)
as.data.frame(do.call(rbind, results))
}
library(httr)
library(jsonlite)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# isolate last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# aggregate total plays per artists
artist_plays <- aggregate(spotify_2018$Plays, by=list(Artist=spotify_2018$Artist), FUN=sum)
top_20 <- head(artist_plays[order(artist_plays$x, decreasing=TRUE),], 20)
rownames(top_20) <- 1:20
colnames(top_20) <- c("Artist","Total Plays")
# sapply to get songkick IDs (RUN FUNCTIONS IN functions.R)
top_20$'Songkick ID' <- sapply(as.character(top_20$Artist), artist_name_to_songkick_artist_id)
write.csv(top_20, "data/raw-data/artist_data.csv")
# Source functions
source(functions.R)
# Source functions
source("functions.R")
# Source functions
source("R/functions.R")
# sapply to get songkick IDs (RUN FUNCTIONS IN functions.R)
top_20$'Songkick ID' <- sapply(as.character(top_20$Artist), artist_name_to_songkick_artist_id)
top_20_artists_events_df <- data_frame_via_lapply(as.character(top_20$'Songkick ID'), songkick_events_by_artist_id)
View(top_20_artists_events_df)
artist_name_to_songkick_artist_id <- function(artist_name){
sk_api_key <- "OdCeFTr8qFUSwUVt"
sk_query_url <- paste ("https://api.songkick.com/api/3.0/search/artists.json?apikey=", sk_api_key,
"&query=", URLencode(artist_name), sep="")
sk_json <- fromJSON(sk_query_url)
# Pause to avoid 503 error on loop
Sys.sleep(0.5)
result <- as.character(sk_json[['resultsPage']][['results']][['artist']][['id']][1])
}
top_20$'Songkick ID' <- sapply(as.character(top_20$Artist), artist_name_to_songkick_artist_id)
View(top_20)
source('~/SHU/Year 2/admp/R/functions.R', echo=TRUE)
# API key
sk_api_key <- "OdCeFTr8qFUSwUVt"
paste0("https://api.songkick.com/api/3.0/search/artists.json?apikey=",
sk_api_key,
"&query=",
URLencode(artist_name))
View(spotify)
View(top_20_artists_events_df)
paste0("https://api.songkick.com/api/3.0/venues/", 242145,
".json?apikey=", sk_api_key)
songkick_venue_retrieve_by_id <- function(venueID) {
sk_venue_query_url <- paste0("https://api.songkick.com/api/3.0/venues/", venueID,
".json?apikey=", sk_api_key)
sk_json <- fromJSON(sk_venue_query_url)
venueCapacity <- as.integer(sk_json[["resultsPage"]][["results"]][["venue"]][["capacity"]])
#if(length(venueCapacity) < 1) { venueCapacity = NA }
venueLng <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lng"]])
#if(length(venueLng) < 1) { venueLng = NA }
venueLat <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lat"]])
#if(length(venueLat) < 1) { venueLat = NA }
cbind(venueID, venueCapacity, venueLng, venueLat)
}
venues_list <- unique(na.omit(as.character(top_20_artists_events_df$venueID)),incomparables=FALSE)
View(top_20_artists_events_df)
top_20_artists_events_df$venueID
venue_list2 <- unique(top_20_artists_events_df$venueID)
venue_list2 <- as.character(unique(top_20_artists_events_df$venueID))
songkick_venues <- data_frame_via_lapply(venues_list, songkick_venue_retrieve_by_id)
#
songkick_venues <- data_frame_via_lapply(venues_list, songkick_venue_retrieve_by_id)
songkick_venue_retrieve_by_id <- function(venueID) {
sk_venue_query_url <- paste0("https://api.songkick.com/api/3.0/venues/", venueID,
".json?apikey=", sk_api_key)
sk_json <- fromJSON(sk_venue_query_url)
venueCapacity <- as.integer(sk_json[["resultsPage"]][["results"]][["venue"]][["capacity"]])
#if(length(venueCapacity) < 1) { venueCapacity = NA }
venueLng <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lng"]])
#if(length(venueLng) < 1) { venueLng = NA }
venueLat <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lat"]])
#if(length(venueLat) < 1) { venueLat = NA }
cbind(venueID, venueCapacity, venueLng, venueLat)
}
songkick_venues <- data_frame_via_lapply(venues_list, songkick_venue_retrieve_by_id)
songkick_venue_retrieve_by_id <- function(venueID) {
sk_venue_query_url <- paste0("https://api.songkick.com/api/3.0/venues/", venueID,
".json?apikey=", sk_api_key)
sk_json <- fromJSON(sk_venue_query_url)
venueCapacity <- as.integer(sk_json[["resultsPage"]][["results"]][["venue"]][["capacity"]])
if(length(venueCapacity) < 1) { venueCapacity = NA }
venueLng <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lng"]])
if(length(venueLng) < 1) { venueLng = NA }
venueLat <- as.double(sk_json[["resultsPage"]][["results"]][["venue"]][["lat"]])
if(length(venueLat) < 1) { venueLat = NA }
cbind(venueID, venueCapacity, venueLng, venueLat)
}
songkick_venues <- data_frame_via_lapply(venues_list, songkick_venue_retrieve_by_id)
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
install.packages("stringr")
library(stringr)
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
View(spotify_last6months)
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1]) %>%
rename('Start date' = v1, 'End date' = v2)
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify <- spotify %>%
cbind(spotify_last6months) %>%
mutate(Month = month("Start wk"))
spotify <- spotify %>%
cbind(spotify_last6months)
View(spotify)
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk") %>%
sapply(1:2, as.Date())
colnames(spotify_last6months) <- c("Start Wk", "End Wk") %>%
sapply(as.Date())
spotify_last6months <- sapply(1:2, as.Date())
spotify_last6months <- sapply(spotify_last6months, as.Date())
spotify_last6months <- sapply(unlist(spotify_last6months), as.Date())
spotify_last6months <- lapply(unlist(spotify_last6months), as.Date())
spotify_last6months <- vapply(unlist(spotify_last6months), as.Date())
(unlist(spotify_last6months)
unlist(spotify_last6months)
spotify_last6months[1]
spotify_last6months <- mapply(as.Date(), spotify_last6months[1], spotify_last6months[2])
as.Date(spotify_last6months$V1
as.Date(spotify_last6months$V1)
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
as.Date(spotify_last6months$V1)
as.Date(spotify_last6months[,1])
spotify_last6months <- mapply(as.Date(), spotify_last6months[,1], spotify_last6months[,2])
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify <- spotify %>%
cbind(spotify_last6months)
library(lubridate)
install.packages("lubridate")
library(lubridate)
packrat::snapshot()
View(spotify)
max("Start Wk")
# combine week's start and end dates columns with spotify dataframe
spotify <- spotify %>%
cbind(spotify_last6months) %>%
filter("Start Wk" > max("Start Wk")-180)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify <- spotify %>%
cbind(spotify_last6months) %>%
filter("Start Wk" > max("Start Wk")-180)
max("Start Wk")-180
spotify$max("Start Wk")
spotify$max("Start Wk")
library(lubridate)
spotify <- spotify %>%
cbind(spotify_last6months)
which.max(spotify$`Start Wk`)
max(spotify$`Start Wk`)
max(spotify$`Start Wk`)-days(180)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
filter("Start Wk" > max(spotify$`Start Wk`)-days(180))
max(spotify$`Start Wk`)-days(180)
max(spotify$`Start Wk`)-days(180)
max(spotify$`Start Wk`)-days(180)
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify <- spotify %>%
cbind(spotify_last6months) %>%
filter("Start Wk" < max(spotify$`Start Wk`)-days(180))
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify <- spotify %>%
cbind(spotify_last6months)
max(spotify$`Start Wk`)-days(180)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, 'Start Wk' <= max(spotify$`Start Wk`)-days(180))
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, `Start Wk` <= max(spotify$`Start Wk`)-days(180))
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, `Start Wk` =< max(spotify$`Start Wk`)-days(180))
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, `Start Wk` < max(spotify$`Start Wk`)-days(180))
max(spotify$`Start Wk`)-days(180)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, `Start Wk` <= as.Date(max(spotify$`Start Wk`)-days(180)))
library(dplyr)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
spotify1 <- filter(spotify, `Start Wk` <= max(spotify$`Start Wk`)-days(180))
max(spotify$`Start Wk`)-days(180)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
last6month <- max(spotify$`Start Wk`)-days(180)
max(spotify$`Start Wk`)-days(180)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
last6month <- c(max(spotify$`Start Wk`)-days(180))
max(spotify$`Start Wk`)
days(180)
max(spotify$`Start Wk`)-days(180)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months) %>%
last6month <- max(spotify$`Start Wk`)-days(180)
last6month <- max(spotify$`Start Wk`)-days(180)
spotify1 <- filter(spotify, `Start Wk` <= max(spotify$`Start Wk`)-days(180))
View(spotify1)
spotify1 <- filter(spotify, `Start Wk` >= max(spotify$`Start Wk`)-days(180))
View(spotify1)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months)  %>%
filter(spotify, `Start Wk` >= max(spotify$`Start Wk`)-days(180))
rm(spotify1)
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify <- spotify %>%
cbind(spotify_last6months)  %>%
filter(spotify, `Start Wk` >= max(spotify$`Start Wk`)-days(180))
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify <- spotify %>%
cbind(spotify_last6months)  %>%
filter(`Start Wk` >= max(spotify$`Start Wk`)-days(180))
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify_last6months <-  cbind(spotify)
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
spotify_last6months <- spotify_last6months %>%
cbind(spotify)
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify_last6months <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(spotify$`Start Wk`)-days(180) )
spotify_last6months <- filter(spotify_last6months, `Start Wk` >= max(spotify$`Start Wk`)-days(180) )
max(spotify$`Start Wk`)-days(180)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify_last6months <- spotify_last6months %>%
cbind(spotify) %>%
filter(spotify_last6months, `Start Wk` >= max(`Start Wk`)-days(180) )
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months
spotify_last6months <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) )
artist_plays <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays))
# combine week's start and end dates columns with spotify dataframe and get last 6 months then summarise total plays
spotify_last6months <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
artist_plays <- group_by(spotify_last6months, Artist) %>%
summarise(`Total plays` = sum(Plays))
artist_plays <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(`Start Wk`, Artist, Plays) %>%
group_by(`Start Wk`, Artist) %>%
summarise(`Total plays` = sum(Plays))
artist_plays <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(`Start Wk`, Artist, Plays)
artist_plays <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) )
artist_plays <- cbind(spotify_last6months, spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(`Start Wk`, Artist, Plays) %>%
group_by(`Start Wk`, Artist) %>%
summarise(`Total plays` = sum(Plays))
artist_plays <- cbind(spotify_last6months, spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) )
spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) )
spotify_last6months %>%
cbind(spotify) %>%
spotify_last6months %>%
cbind(spotify)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# select last 6 months (last 26 weeks of 200 chart positions)
spotify_2018 <- spotify[substr(spotify$Week,1,4) == "2018", ]
# split week column into start and end of the week
spotify_last6months <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_last6months) <- c("Start Wk", "End Wk")
spotify_last6months[,1:2] <- lapply(spotify_last6months[,1:2], as.Date)
artist_plays <- spotify_last6months %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(`Start Wk`, Artist, Plays) %>%
group_by(`Start Wk`,Artist) %>%
summarise(`Total plays` = sum(Plays))
View(artist_plays)
# import spotify dataset
spotify <- read.csv("data/raw-data/spotify.csv")
# split week column into start and end of the week
spotify_wks <- as.data.frame(str_match(spotify$Week, "^(.*)--(.*)$")[,-1])
colnames(spotify_wks) <- c("Start Wk", "End Wk")
spotify_wks[,1:2] <- lapply(spotify_wks[,1:2], as.Date)
# combine week's start and end dates columns with spotify dataframe and get last 6 months then summarise total plays
artist_plays <- spotify_wks %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(Artist, Plays) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays))
View(artist_plays)
?order_by
?arrange
# combine week's start and end dates columns with spotify dataframe and get last 6 months then summarise total plays
artist_plays <- spotify_wks %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(Artist, Plays) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays)) %>%
arrange(desc(Plays))
artist_plays <- spotify_wks %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(Artist, Plays) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays)) %>%
arrange(desc(`Total plays`))
View(artist_plays)
View(artist_plays)
# combine week's start and end dates columns with spotify dataframe, get last 6 months,summarise total plays, keep top20
artist_plays <- spotify_wks %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(Artist, Plays) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays)) %>%
arrange(desc(`Total plays`)) %>%
top_n(20)
View(artist_plays)
top_20 <- spotify_wks %>%
cbind(spotify) %>%
filter(`Start Wk` >= max(`Start Wk`)-days(180) ) %>%
select(Artist, Plays) %>%
group_by(Artist) %>%
summarise(`Total plays` = sum(Plays)) %>%
arrange(desc(`Total plays`)) %>%
top_n(20)
# sapply to get songkick IDs (RUN FUNCTIONS IN functions.R)
top_20$'Songkick ID' <- sapply(as.character(top_20$Artist), artist_name_to_songkick_artist_id)
